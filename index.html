<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bronco Braves ‚Äî Line Drive Reads Drill</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #1a1c1e;
    --surface: #232629;
    --surface-hover: #2c2f33;
    --border: #3a3d42;
    --text: #e8e9ea;
    --text-muted: #8b9098;
    --accent-gold: #d4a843;
    --accent-blue: #4a90d9;
    --accent-red: #d94a4a;
    --accent-green: #4abd8c;
    --accent-orange: #e8943a;
    --accent-purple: #9b59b6;
    --field-green: #2d6b2d;
    --field-dark: #1e4d1e;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Nunito', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
  }

  header {
    background: var(--surface);
    border-bottom: 2px solid var(--accent-gold);
    padding: 14px 24px;
    display: flex; align-items: center; justify-content: space-between;
    flex-wrap: wrap; gap: 12px;
  }
  .team-brand { display: flex; align-items: center; gap: 12px; }
  .team-logo {
    font-size: 28px; width: 44px; height: 44px;
    background: var(--accent-gold); border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
  }
  .team-name {
    font-family: 'Bebas Neue', sans-serif; font-size: 26px;
    letter-spacing: 2px; color: var(--accent-gold);
  }
  .team-sub {
    font-size: 11px; color: var(--text-muted); font-weight: 700;
    text-transform: uppercase; letter-spacing: 1px;
  }

  .main-layout { display: flex; height: calc(100vh - 72px); overflow: hidden; }

  /* ‚îÄ‚îÄ SIDE PANEL ‚îÄ‚îÄ */
  .side-panel {
    width: 320px; min-width: 320px;
    background: var(--bg);
    border-right: 1px solid var(--border);
    display: flex; flex-direction: column; overflow: hidden;
  }
  .panel-tabs { display: flex; border-bottom: 1px solid var(--border); }
  .panel-tab {
    flex: 1; padding: 10px 8px; text-align: center;
    font-size: 11px; font-weight: 800; text-transform: uppercase;
    letter-spacing: 0.8px; color: var(--text-muted);
    cursor: pointer; border-bottom: 2px solid transparent;
    transition: all 0.15s; background: transparent;
    border-top: none; border-left: none; border-right: none;
  }
  .panel-tab:hover { color: var(--text); }
  .panel-tab.active { color: var(--accent-gold); border-bottom-color: var(--accent-gold); }
  .panel-content { flex: 1; overflow-y: auto; padding: 16px; }
  .panel-content.hidden { display: none; }

  /* ‚îÄ‚îÄ ROSTER ‚îÄ‚îÄ */
  .roster-section-label {
    font-family: 'Bebas Neue', sans-serif; font-size: 16px;
    letter-spacing: 1.5px; color: var(--accent-gold);
    margin-bottom: 8px; display: flex; align-items: center; gap: 8px;
  }
  .roster-section-label .count {
    font-family: 'Nunito', sans-serif; font-size: 10px; font-weight: 800;
    background: var(--accent-gold); color: #1a1c1e;
    padding: 2px 7px; border-radius: 10px;
  }
  .count.red { background: var(--accent-red); color: #fff; }

  .player-tile {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 8px; padding: 8px 10px; margin-bottom: 4px;
    display: flex; align-items: center; gap: 8px;
    transition: all 0.15s; user-select: none; cursor: pointer;
  }
  .player-tile:hover { border-color: var(--accent-gold); background: var(--surface-hover); }
  .player-tile .jersey {
    font-family: 'Bebas Neue', sans-serif; font-size: 18px;
    color: var(--accent-gold); min-width: 26px; text-align: center;
  }
  .player-tile .pname {
    font-size: 12px; font-weight: 700; flex: 1;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }
  .player-tile .tile-action {
    width: 22px; height: 22px; border-radius: 4px;
    border: 1px solid var(--border); background: transparent;
    color: var(--text-muted); font-size: 12px; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.15s; flex-shrink: 0;
  }
  .player-tile.absent { background: #2a1e1e; border-color: #5a2a2a; opacity: 0.55; }
  .player-tile.absent .tile-action { background: var(--accent-red); border-color: var(--accent-red); color: #fff; }
  .player-tile.assigned { border-color: var(--accent-green); background: #1e2e24; }
  .group-badge {
    font-size: 9px; font-weight: 800; padding: 2px 6px;
    border-radius: 4px; text-transform: uppercase; letter-spacing: 0.5px;
  }
  .group-badge.g1 { background: rgba(74, 144, 217, 0.2); color: var(--accent-blue); }
  .group-badge.g2 { background: rgba(232, 148, 58, 0.2); color: var(--accent-orange); }

  /* ‚îÄ‚îÄ NOTES ‚îÄ‚îÄ */
  .note-card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 10px; padding: 16px; margin-bottom: 12px;
  }
  .note-card-title {
    font-family: 'Bebas Neue', sans-serif; font-size: 17px;
    letter-spacing: 1px; margin-bottom: 8px;
    display: flex; align-items: center; gap: 8px;
  }
  .note-card p {
    font-size: 13px; line-height: 1.6; color: var(--text-muted); margin-bottom: 8px;
  }
  .note-card p:last-child { margin-bottom: 0; }
  .note-card strong { color: var(--text); }
  .highlight {
    background: rgba(212, 168, 67, 0.12); border-left: 3px solid var(--accent-gold);
    padding: 8px 12px; border-radius: 0 6px 6px 0; margin: 8px 0;
    font-size: 12px; line-height: 1.5; color: var(--text);
  }
  .scenario {
    background: var(--surface-hover); border-radius: 6px;
    padding: 10px 12px; margin: 6px 0;
  }
  .scenario-label {
    font-size: 10px; font-weight: 800; text-transform: uppercase;
    letter-spacing: 1px; margin-bottom: 4px;
  }
  .scenario p { font-size: 12px; margin-bottom: 4px; }
  .scenario-label.through { color: var(--accent-green); }
  .scenario-label.caught { color: var(--accent-red); }
  .scenario-label.key { color: var(--accent-gold); }

  /* ‚îÄ‚îÄ HIT ZONE ‚îÄ‚îÄ */
  .hit-zone {
    position: absolute; z-index: 3;
    border: 2px dashed rgba(232, 148, 58, 0.35);
    background: rgba(232, 148, 58, 0.05);
    transform: translate(-50%, -50%);
    pointer-events: none;
  }
  .hit-zone-label {
    position: absolute; top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    font-size: 10px; font-weight: 800; text-transform: uppercase;
    letter-spacing: 1px; color: rgba(232, 148, 58, 0.45);
    white-space: nowrap;
  }

  /* Hit path arrows */
  .hit-path {
    position: absolute; z-index: 2; pointer-events: none;
  }

  /* ‚îÄ‚îÄ FIELD ‚îÄ‚îÄ */
  .field-area {
    flex: 1; position: relative; overflow: hidden;
    background: var(--field-green);
    background-image: radial-gradient(ellipse 90% 70% at 50% 95%, var(--field-dark) 0%, transparent 70%);
  }
  .field-svg {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
  }

  .field-marker {
    position: absolute; transform: translate(-50%, -50%);
    z-index: 10; display: flex; flex-direction: column;
    align-items: center; gap: 2px;
  }
  .marker-tile {
    min-width: 110px; padding: 6px 10px;
    border-radius: 8px; display: flex; align-items: center;
    gap: 6px; backdrop-filter: blur(4px);
    font-size: 11px; font-weight: 700;
  }
  .marker-tile.coach {
    border: 2px solid var(--accent-blue);
    background: rgba(20, 40, 70, 0.85); color: var(--accent-blue);
  }
  .marker-tile.parent {
    border: 2px solid var(--accent-purple);
    background: rgba(40, 20, 50, 0.85); color: var(--accent-purple);
  }
  .marker-tile .tile-icon { font-size: 14px; }

  /* Staff toggle */
  .staff-toggle {
    position: absolute; z-index: 15; transform: translate(-50%, -50%);
    display: flex; flex-direction: column; align-items: center; gap: 3px;
  }
  .staff-label-top {
    font-family: 'Bebas Neue', sans-serif; font-size: 11px;
    letter-spacing: 1px; color: rgba(255,255,255,0.5);
    text-shadow: 0 1px 3px rgba(0,0,0,0.5);
  }
  .staff-tile {
    min-width: 120px; padding: 7px 10px;
    border-radius: 8px; display: flex; align-items: center;
    gap: 7px; backdrop-filter: blur(4px); cursor: pointer;
    font-size: 11px; font-weight: 700; transition: all 0.15s;
  }
  .staff-tile.coach-type {
    border: 2px solid var(--accent-blue);
    background: rgba(20, 40, 70, 0.85); color: var(--accent-blue);
  }
  .staff-tile.parent-type {
    border: 2px solid var(--accent-purple);
    background: rgba(40, 20, 50, 0.85); color: var(--accent-purple);
  }
  .staff-tile:hover { filter: brightness(1.2); }
  .staff-tile .tile-icon { font-size: 15px; }
  .staff-tile .tile-text { flex: 1; }
  .staff-tile .toggle-btn {
    font-size: 9px; padding: 2px 6px; border-radius: 3px;
    background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
    color: rgba(255,255,255,0.6); cursor: pointer; font-weight: 800;
    letter-spacing: 0.5px;
  }
  .staff-tile .toggle-btn:hover { background: rgba(255,255,255,0.2); }

  .staff-name-input {
    width: 100%; margin-top: 4px; padding: 4px 8px;
    font-family: 'Nunito', sans-serif; font-size: 11px; font-weight: 700;
    background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.15);
    border-radius: 5px; color: var(--text); outline: none;
    transition: border-color 0.15s;
  }
  .staff-name-input::placeholder { color: rgba(255,255,255,0.25); font-weight: 600; }
  .staff-name-input:focus { border-color: var(--accent-gold); background: rgba(0,0,0,0.45); }

  /* Player group stacks */
  .group-stack {
    min-width: 120px; border-radius: 8px; overflow: hidden;
    backdrop-filter: blur(4px);
  }
  .group-stack-header {
    padding: 5px 10px; font-size: 10px; font-weight: 800;
    text-transform: uppercase; letter-spacing: 1px;
    display: flex; align-items: center; gap: 6px;
  }
  .group-stack-header.g1 { background: rgba(74, 144, 217, 0.3); color: var(--accent-blue); }
  .group-stack-header.g2 { background: rgba(232, 148, 58, 0.3); color: var(--accent-orange); }
  .group-stack-body {
    background: rgba(20, 20, 25, 0.85);
    border: 2px solid rgba(255,255,255,0.15); border-top: none;
    border-radius: 0 0 8px 8px;
  }
  .group-player {
    padding: 4px 10px; font-size: 11px; font-weight: 700;
    display: flex; align-items: center; gap: 6px;
    border-bottom: 1px solid rgba(255,255,255,0.05);
  }
  .group-player:last-child { border-bottom: none; }
  .group-player .jersey {
    font-family: 'Bebas Neue', sans-serif; font-size: 15px; color: var(--accent-gold);
    min-width: 22px; text-align: center;
  }

  @media (max-width: 900px) {
    .main-layout { flex-direction: column; height: auto; }
    .side-panel { width: 100%; min-width: 100%; max-height: 45vh; border-right: none; border-bottom: 1px solid var(--border); }
    .field-area { min-height: 550px; }
  }
</style>
</head>
<body>

<header>
  <div class="team-brand">
    <div class="team-logo">‚öæ</div>
    <div>
      <div class="team-name">BRONCO BRAVES</div>
      <div class="team-sub">Line Drive Reads ‚Äî Base Running Drill</div>
    </div>
  </div>
  <div style="margin-left:auto;">
    <button onclick="exportPrint()" style="font-family:'Nunito',sans-serif;font-size:12px;font-weight:700;padding:7px 14px;border-radius:6px;cursor:pointer;border:1px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.08);color:#e8e9ea;text-transform:uppercase;letter-spacing:0.5px;">üñ® Print</button>
  </div>
</header>

<div class="main-layout">
  <div class="side-panel">
    <div class="panel-tabs">
      <button class="panel-tab active" onclick="switchTab('roster',this)">Roster</button>
      <button class="panel-tab" onclick="switchTab('reads',this)">Reads</button>
      <button class="panel-tab" onclick="switchTab('setup',this)">Setup</button>
    </div>

    <!-- ROSTER TAB -->
    <div class="panel-content" id="tab-roster">
      <div style="margin-bottom:12px;">
        <div class="roster-section-label">
          <span>üèÉ Group 1 ‚Äî Runners at 1B</span>
          <span class="count" id="g1Count">0</span>
        </div>
        <div id="group1Area"></div>
        <div style="margin-top:12px;">
          <div class="roster-section-label">
            <span>üèÉ Group 2 ‚Äî Runners at 2B</span>
            <span class="count" id="g2Count">0</span>
          </div>
          <div id="group2Area"></div>
        </div>
      </div>
      <div style="border-top:1px solid var(--border); padding-top:12px; margin-top:8px;">
        <div class="roster-section-label">
          <span>Unassigned</span>
          <span class="count" id="unassignedCount" style="background:var(--border);">0</span>
        </div>
        <div id="unassignedArea"></div>
      </div>
      <div style="border-top:1px solid var(--border); padding-top:12px; margin-top:12px;">
        <div class="roster-section-label">
          <span style="color:var(--accent-red);">Absent</span>
          <span class="count red" id="absentCount">0</span>
        </div>
        <div id="absentArea"></div>
      </div>
    </div>

    <!-- READS TAB -->
    <div class="panel-content hidden" id="tab-reads">
      <div class="note-card">
        <div class="note-card-title" style="color:var(--accent-gold);">
          <span>üß†</span> Line Drive Reads ‚Äî Both Bases
        </div>
        <p>Coach hits <strong>line drives at or over the head</strong> of the second baseman. Runners must read instantly.</p>

        <div class="scenario">
          <div class="scenario-label key">‚ö° Key coaching point: Early read</div>
          <p><strong>Eyes on the ball off the bat.</strong> The read starts immediately ‚Äî not after the ball passes the infielder. Runners should be reading trajectory and the 2B's reaction in the first half-second.</p>
        </div>

        <div class="scenario">
          <div class="scenario-label through">üü¢ Ball gets through / drops into RF</div>
          <p><strong>Advance two bases.</strong> Runner on 1st ‚Üí scores or reaches 3rd. Runner on 2nd ‚Üí scores.</p>
          <p>Because you made an early read, you had an aggressive secondary and were already moving. The ball getting into RF gives you time to take two.</p>
          <div class="highlight">
            üí° The early read is what makes two bases possible. A late read means you only get one.
          </div>
        </div>

        <div class="scenario">
          <div class="scenario-label caught">üî¥ 2nd baseman catches it</div>
          <p><strong>Get back to your base.</strong> The 2B can make a quick throw to either 1st or 2nd to double you off.</p>
          <p>You should never be so far off the base that you can't recover on a line drive catch. That's the balance ‚Äî aggressive secondary, but always with the ability to retreat.</p>
          <div class="highlight">
            üí° Line drives are the most dangerous play for a baserunner. Never assume it's through ‚Äî read it.
          </div>
        </div>
      </div>

      <div class="note-card">
        <div class="note-card-title" style="color:var(--accent-blue);">
          <span>üéØ</span> Runner on 1st ‚Äî Specifics
        </div>
        <p>Take your lead, take your secondary. Eyes locked on the ball.</p>
        <p><strong>If through:</strong> Sprint hard. The goal is 3rd base (or home if the RF bobbles or throws poorly). Two bags minimum.</p>
        <p><strong>If caught:</strong> Dive or sprint back to 1st. The 2B will fire to the 1st baseman quickly ‚Äî you need to be close enough to get back.</p>
      </div>

      <div class="note-card">
        <div class="note-card-title" style="color:var(--accent-orange);">
          <span>üéØ</span> Runner on 2nd ‚Äî Specifics
        </div>
        <p>Take your lead, take your secondary. Read the ball immediately.</p>
        <p><strong>If through:</strong> Score. You should be rounding 3rd with a full head of steam. The RF has to field it and make a long throw home.</p>
        <p><strong>If caught:</strong> Get back to 2nd. The 2B's throw to 2nd is short ‚Äî don't get doubled off.</p>
      </div>
    </div>

    <!-- SETUP TAB -->
    <div class="panel-content hidden" id="tab-setup">
      <div class="note-card">
        <div class="note-card-title" style="color:var(--accent-blue);">
          <span>üìã</span> Field Setup ‚Äî 6 Spots (+1 Optional)
        </div>
        <p>Click the <strong>swap</strong> button on any field position to toggle between Coach and Parent.</p>

        <div class="scenario">
          <div class="scenario-label key">Coaches (locked): 4</div>
          <p><strong>üß¢ Hitter / Catcher</strong> ‚Äî At home plate with a fungo and a glove. Hits the line drive, then puts on the glove to receive as catcher.</p>
          <p><strong>üß¢ 2nd Baseman</strong> ‚Äî Fielding position, catching or letting balls through</p>
          <p><strong>üß¢ Right Fielder #1</strong> ‚Äî Fielding balls that get through, throwing home</p>
          <p><strong>üß¢ Right Fielder #2</strong> ‚Äî Fielding balls that get through, throwing home</p>
        </div>

        <div class="scenario">
          <div class="scenario-label" style="color:var(--accent-purple);">Coach or Parent (swappable): 2</div>
          <p><strong>üß¢/üë§ 1st Baseman</strong> ‚Äî Cutoff man on throws home; bucket at 1B for collected balls</p>
          <p><strong>üß¢/üë§ 3rd Baseman</strong> ‚Äî Glove ready as backup, just in case</p>
        </div>

        <div class="scenario">
          <div class="scenario-label" style="color:var(--accent-green);">Optional (+1 if available)</div>
          <p><strong>üß¢/üë§ Shortstop</strong> ‚Äî Back pick the runner at 2nd base. Nice to have if an extra coach or parent is around.</p>
        </div>
      </div>

      <div class="note-card">
        <div class="note-card-title" style="color:var(--accent-orange);">
          <span>üîß</span> Equipment & Cones
        </div>
        <p><strong>Baseballs</strong> ‚Äî bucket at home plate for the hitter, bucket at 1st base for collected balls</p>
        <p><strong>Cones</strong> ‚Äî set up behind 1st base and behind 2nd base where kids wait in line before taking the base for their rep</p>
      </div>

      <div class="note-card">
        <div class="note-card-title" style="color:var(--accent-green);">
          <span>üîÑ</span> Rotation Flow
        </div>
        <p><strong>After running at 1st base:</strong> Get in line at the cones for 2nd base.</p>
        <p><strong>After running at 2nd base:</strong> Run all the way around the field, behind the coach hitting, and get back in line at 1st base.</p>
        <p style="margin-top:6px;opacity:0.7;font-size:12px;">This keeps the drill continuous ‚Äî every player cycles through both base reads.</p>
      </div>
    </div>
  </div>

  <!-- FIELD -->
  <div class="field-area" id="fieldArea">
    <svg class="field-svg" viewBox="0 0 1000 1000" preserveAspectRatio="xMidYMid meet">
      <path d="M 20 950 Q 20 150 500 30 Q 980 150 980 950 Z" fill="#2d6b2d" stroke="none"/>
      <polygon points="500,430 710,650 500,870 290,650" fill="#c4975a" opacity="0.25" stroke="rgba(255,255,255,0.12)" stroke-width="1.5"/>
      <line x1="500" y1="870" x2="710" y2="650" stroke="rgba(255,255,255,0.15)" stroke-width="2"/>
      <line x1="710" y1="650" x2="500" y2="430" stroke="rgba(255,255,255,0.15)" stroke-width="2"/>
      <line x1="500" y1="430" x2="290" y2="650" stroke="rgba(255,255,255,0.15)" stroke-width="2"/>
      <line x1="290" y1="650" x2="500" y2="870" stroke="rgba(255,255,255,0.15)" stroke-width="2"/>
      <circle cx="500" cy="640" r="14" fill="#c4975a" opacity="0.4"/>
      <rect x="493" y="863" width="14" height="14" fill="white" transform="rotate(45 500 870)" opacity="0.6"/>
      <rect x="703" y="643" width="12" height="12" fill="white" transform="rotate(45 709 649)" opacity="0.6"/>
      <rect x="494" y="423" width="12" height="12" fill="white" transform="rotate(45 500 429)" opacity="0.6"/>
      <rect x="284" y="643" width="12" height="12" fill="white" transform="rotate(45 290 649)" opacity="0.6"/>
      <line x1="500" y1="870" x2="30" y2="350" stroke="rgba(255,255,255,0.1)" stroke-width="1.5"/>
      <line x1="500" y1="870" x2="970" y2="350" stroke="rgba(255,255,255,0.1)" stroke-width="1.5"/>
      <path d="M 100 400 Q 500 80 900 400" fill="none" stroke="rgba(255,255,255,0.06)" stroke-width="2"/>

      <!-- Hit path arrows: line drives from home through 2B area into RF -->
      <defs>
        <marker id="arrow" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
          <polygon points="0 0, 8 3, 0 6" fill="rgba(232,148,58,0.5)"/>
        </marker>
      </defs>
      <line x1="500" y1="850" x2="580" y2="560" stroke="rgba(232,148,58,0.25)" stroke-width="2" stroke-dasharray="8,4" marker-end="url(#arrow)"/>
      <line x1="500" y1="850" x2="620" y2="540" stroke="rgba(232,148,58,0.25)" stroke-width="2" stroke-dasharray="8,4" marker-end="url(#arrow)"/>
      <line x1="500" y1="850" x2="550" y2="550" stroke="rgba(232,148,58,0.25)" stroke-width="2" stroke-dasharray="8,4" marker-end="url(#arrow)"/>
    </svg>

    <!-- Hit zone indicator -->
    <div class="hit-zone" style="left:58%;top:52%;width:180px;height:120px;border-radius:40%;">
      <div class="hit-zone-label">Line Drive Zone</div>
    </div>

    <!-- Field positions rendered by JS -->
    <div id="fieldMarkers"></div>
  </div>
</div>

<script>
const PLAYERS = [
  { id: 1, jersey: 24, name: "J. Reinhardt", first: "Jackson" },
  { id: 2, jersey: 23, name: "H. Reinhardt", first: "Henry" },
  { id: 3, jersey: 67, name: "B. Cox", first: "Brooks" },
  { id: 4, jersey: 7, name: "R. Sullivan", first: "Ryder" },
  { id: 5, jersey: 44, name: "G. Williams", first: "Graham W." },
  { id: 6, jersey: 4, name: "C. Coleman", first: "Chandler" },
  { id: 7, jersey: 9, name: "M. Cage", first: "Miles" },
  { id: 8, jersey: 8, name: "M. Warren", first: "Micah" },
  { id: 9, jersey: 16, name: "L. Fraser", first: "Langston" },
  { id: 10, jersey: 27, name: "N. Crosby", first: "Neal" },
  { id: 11, jersey: 99, name: "G. Sprague", first: "Graham S." },
  { id: 12, jersey: 2, name: "F. Butler", first: "Ford" }
];

// Staff positions on field - each can toggle between coach/parent
const STAFF_POSITIONS = [
  { key: "hitter", label: "Hitter / Catcher", x: 50, y: 91, defaultType: "coach", locked: true, role: "Hits fungo ‚Üí glove on to catch" },
  { key: "2b", label: "2nd Baseman", x: 60, y: 56, defaultType: "coach", locked: true, role: "Fielding / letting through" },
  { key: "rf1", label: "Right Fielder #1", x: 74, y: 30, defaultType: "coach", locked: true, role: "Fielding & throwing home" },
  { key: "rf2", label: "Right Fielder #2", x: 82, y: 38, defaultType: "coach", locked: true, role: "Fielding & throwing home" },
  { key: "1b", label: "1st Baseman", x: 70, y: 68, defaultType: "coach", locked: false, role: "Cutoff man / bucket" },
  { key: "3b", label: "3rd Baseman", x: 30, y: 68, defaultType: "coach", locked: false, role: "Glove ready, backup" },
  { key: "ss", label: "Shortstop (Optional)", x: 38, y: 55, defaultType: "coach", locked: false, role: "Back pick runner at 2B", optional: true },
];

// State
let groups = { 1: [], 2: [] };
let absentSet = new Set();
let staffTypes = {};
let staffNames = {};
let staffEnabled = {};
STAFF_POSITIONS.forEach(s => { staffTypes[s.key] = s.defaultType; staffNames[s.key] = ''; staffEnabled[s.key] = !s.optional; });

function getAssignedIds() {
  return new Set([...groups[1], ...groups[2]]);
}

function assignPlayer(id, group) {
  groups[1] = groups[1].filter(x => x !== id);
  groups[2] = groups[2].filter(x => x !== id);
  if (group) groups[group].push(id);
  render();
}

function toggleAbsent(id) {
  groups[1] = groups[1].filter(x => x !== id);
  groups[2] = groups[2].filter(x => x !== id);
  if (absentSet.has(id)) absentSet.delete(id);
  else absentSet.add(id);
  render();
}

function toggleStaffType(key) {
  staffTypes[key] = staffTypes[key] === 'coach' ? 'parent' : 'coach';
  render();
  // Re-focus the name input after re-render
  setTimeout(() => {
    const inp = document.getElementById('staff-name-' + key);
    if (inp) inp.focus();
  }, 10);
}

function updateStaffName(key, value) {
  staffNames[key] = value;
  // Don't re-render ‚Äî just store the value
}

function autoSplit() {
  const available = PLAYERS.filter(p => !absentSet.has(p.id)).map(p => p.id);
  for (let i = available.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [available[i], available[j]] = [available[j], available[i]];
  }
  const half = Math.ceil(available.length / 2);
  groups[1] = available.slice(0, half);
  groups[2] = available.slice(half);
  render();
}

function clearGroups() {
  groups = { 1: [], 2: [] };
  render();
}

function render() {
  renderRoster();
  renderField();
}

function renderRoster() {
  const assigned = getAssignedIds();

  const g1El = document.getElementById('group1Area');
  g1El.innerHTML = groups[1].length === 0
    ? '<div style="padding:8px;color:var(--text-muted);font-size:11px;text-align:center;">Click a player below to assign</div>'
    : groups[1].map(id => playerHTML(PLAYERS.find(x => x.id === id), 1)).join('');
  document.getElementById('g1Count').textContent = groups[1].length;

  const g2El = document.getElementById('group2Area');
  g2El.innerHTML = groups[2].length === 0
    ? '<div style="padding:8px;color:var(--text-muted);font-size:11px;text-align:center;">Click a player below to assign</div>'
    : groups[2].map(id => playerHTML(PLAYERS.find(x => x.id === id), 2)).join('');
  document.getElementById('g2Count').textContent = groups[2].length;

  const unassigned = PLAYERS.filter(p => !assigned.has(p.id) && !absentSet.has(p.id));
  const uEl = document.getElementById('unassignedArea');
  uEl.innerHTML = (unassigned.length === 0
    ? '<div style="padding:8px;color:var(--text-muted);font-size:11px;text-align:center;">All players assigned</div>'
    : `<div style="display:flex;gap:4px;margin-bottom:8px;">
        <button onclick="autoSplit()" style="flex:1;font-family:'Nunito',sans-serif;font-size:11px;font-weight:700;padding:6px;border-radius:6px;border:1px solid var(--accent-gold);background:rgba(212,168,67,0.1);color:var(--accent-gold);cursor:pointer;">‚ö° Auto-Split Groups</button>
        <button onclick="clearGroups()" style="font-family:'Nunito',sans-serif;font-size:11px;font-weight:700;padding:6px 10px;border-radius:6px;border:1px solid var(--border);background:transparent;color:var(--text-muted);cursor:pointer;">Clear</button>
      </div>` +
      unassigned.map(p => playerHTML(p, 0)).join(''));
  document.getElementById('unassignedCount').textContent = unassigned.length;

  const absent = PLAYERS.filter(p => absentSet.has(p.id));
  const aEl = document.getElementById('absentArea');
  aEl.innerHTML = absent.length === 0
    ? '<div style="padding:8px;color:var(--text-muted);font-size:11px;text-align:center;">No absences</div>'
    : absent.map(p => playerHTML(p, -1)).join('');
  document.getElementById('absentCount').textContent = absent.length;
}

function playerHTML(p, group) {
  let cls = 'player-tile';
  if (group === -1) cls += ' absent';
  if (group > 0) cls += ' assigned';

  let badge = '';
  if (group === 1) badge = '<span class="group-badge g1">1B</span>';
  if (group === 2) badge = '<span class="group-badge g2">2B</span>';

  let actions = '';
  if (group === -1) {
    actions = `<button class="tile-action" onclick="toggleAbsent(${p.id})" title="Mark present" style="background:var(--accent-red);border-color:var(--accent-red);color:#fff;">‚úì</button>`;
  } else if (group === 0) {
    actions = `
      <button class="tile-action" onclick="assignPlayer(${p.id},1)" title="Group 1 (1B)" style="color:var(--accent-blue);border-color:var(--accent-blue);font-size:10px;font-weight:800;">1B</button>
      <button class="tile-action" onclick="assignPlayer(${p.id},2)" title="Group 2 (2B)" style="color:var(--accent-orange);border-color:var(--accent-orange);font-size:10px;font-weight:800;">2B</button>
      <button class="tile-action" onclick="toggleAbsent(${p.id})" title="Mark absent">‚úï</button>
    `;
  } else {
    actions = `<button class="tile-action" onclick="assignPlayer(${p.id},0)" title="Unassign">‚Ü©</button>`;
  }

  return `<div class="${cls}">
    <span class="jersey">${p.jersey}</span>
    <span class="pname">${p.name}</span>
    ${badge}
    ${actions}
  </div>`;
}

function renderField() {
  const container = document.getElementById('fieldMarkers');
  container.innerHTML = '';

  // Staff positions
  STAFF_POSITIONS.forEach(sp => {
    // Skip optional positions if not enabled
    if (sp.optional && !staffEnabled[sp.key]) {
      // Show a small "add" button
      const div = document.createElement('div');
      div.className = 'staff-toggle';
      div.style.left = sp.x + '%';
      div.style.top = sp.y + '%';
      div.innerHTML = `
        <div class="staff-label-top" style="opacity:0.4;">${sp.label}</div>
        <div class="staff-tile coach-type" style="cursor:pointer;opacity:0.35;border-style:dashed;" onclick="staffEnabled['${sp.key}']=true;render();">
          <span class="tile-icon">Ôºã</span>
          <div style="flex:1;">
            <div class="tile-text" style="font-weight:800;font-size:10px;">Add if available</div>
          </div>
        </div>
      `;
      container.appendChild(div);
      return;
    }

    const type = sp.locked ? 'coach' : staffTypes[sp.key];
    const isCoach = type === 'coach';
    const icon = isCoach ? 'üß¢' : 'üë§';
    const label = isCoach ? 'Coach' : 'Parent';
    const tileClass = isCoach ? 'coach-type' : 'parent-type';

    const div = document.createElement('div');
    div.className = 'staff-toggle';
    div.style.left = sp.x + '%';
    div.style.top = sp.y + '%';

    const swapBtn = sp.locked ? '' : `<span class="toggle-btn" onclick="event.stopPropagation();toggleStaffType('${sp.key}')">swap</span>`;
    const removeBtn = sp.optional ? `<span class="toggle-btn" onclick="event.stopPropagation();staffEnabled['${sp.key}']=false;staffNames['${sp.key}']='';render();" style="color:#d94a4a;border-color:#d94a4a;">‚úï</span>` : '';

    const nameVal = staffNames[sp.key] || '';
    const placeholder = isCoach ? 'Coach name...' : 'Parent name...';

    div.innerHTML = `
      <div class="staff-label-top">${sp.label}</div>
      <div class="staff-tile ${tileClass}" style="${sp.locked ? 'cursor:default;' : 'cursor:pointer;'}${sp.optional ? 'border-style:dashed;' : ''}" ${sp.locked ? '' : `onclick="toggleStaffType('${sp.key}')"`}>
        <span class="tile-icon">${icon}</span>
        <div style="flex:1;">
          <div class="tile-text" style="font-weight:800;">${label}</div>
          <div style="font-size:9px;opacity:0.7;">${sp.role}</div>
        </div>
        ${swapBtn}${removeBtn}
      </div>
      <input type="text" class="staff-name-input" id="staff-name-${sp.key}"
        placeholder="${placeholder}" value="${nameVal}"
        onclick="event.stopPropagation()"
        oninput="updateStaffName('${sp.key}', this.value)">
    `;
    container.appendChild(div);
  });

  // Player group at 1st base area
  addGroupStack(container, 82, 76, 1, 'üèÉ Group 1 ‚Äî 1st Base');

  // Player group at 2nd base area
  addGroupStack(container, 28, 38, 2, 'üèÉ Group 2 ‚Äî 2nd Base');
}

function addGroupStack(container, x, y, groupNum, title) {
  const div = document.createElement('div');
  div.className = 'field-marker';
  div.style.left = x + '%';
  div.style.top = y + '%';

  const players = groups[groupNum].map(id => PLAYERS.find(p => p.id === id));
  const gClass = groupNum === 1 ? 'g1' : 'g2';

  let playersHTML = '';
  if (players.length === 0) {
    playersHTML = '<div style="padding:8px 10px;font-size:10px;color:var(--text-muted);text-align:center;">No players</div>';
  } else {
    playersHTML = players.map(p =>
      `<div class="group-player"><span class="jersey">${p.jersey}</span><span>${p.name}</span></div>`
    ).join('');
  }

  div.innerHTML = `
    <div class="group-stack">
      <div class="group-stack-header ${gClass}">
        <span>üèÉ</span>
        <span>${title}</span>
        <span style="margin-left:auto;font-family:'Bebas Neue',sans-serif;font-size:16px;">${players.length}</span>
      </div>
      <div class="group-stack-body">${playersHTML}</div>
    </div>
  `;
  container.appendChild(div);
}

function switchTab(tabId, btn) {
  document.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
  btn.classList.add('active');
  document.querySelectorAll('.panel-content').forEach(c => c.classList.add('hidden'));
  document.getElementById('tab-' + tabId).classList.remove('hidden');
}

function exportPrint() {
  const today = new Date().toLocaleDateString('en-US', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
  const absentList = PLAYERS.filter(p => absentSet.has(p.id));
  const g1Players = groups[1].map(id => PLAYERS.find(p => p.id === id));
  const g2Players = groups[2].map(id => PLAYERS.find(p => p.id === id));

  const staffRows = STAFF_POSITIONS.filter(sp => !sp.optional || staffEnabled[sp.key]).map(sp => {
    const type = sp.locked ? 'coach' : staffTypes[sp.key];
    const typeLabel = type === 'coach' ? 'Coach' : 'Parent';
    const name = staffNames[sp.key] || '';
    const optTag = sp.optional ? ' <span style="color:#999;font-weight:400;font-style:italic;">(optional)</span>' : '';
    const nameCell = name
      ? `<td style="padding:3px 8px;font-size:10px;border-bottom:1px solid #ddd;">${name}</td>`
      : `<td style="padding:3px 8px;font-size:10px;border-bottom:1px solid #ddd;color:#bbb;">___________________</td>`;
    return `<tr>
      <td style="padding:3px 8px;font-weight:700;font-size:10px;border-bottom:1px solid #ddd;">${sp.label}${optTag}</td>
      <td style="padding:3px 8px;font-size:10px;border-bottom:1px solid #ddd;">${typeLabel}</td>
      <td style="padding:3px 8px;font-size:10px;border-bottom:1px solid #ddd;">${sp.role}</td>
      ${nameCell}
    </tr>`;
  }).join('');

  function playerGrid(players) {
    if (players.length === 0) return `<span style="font-size:10px;color:#999;">None assigned</span>`;
    return players.map(p =>
      `<span style="display:inline-block;padding:2px 8px;margin:1px 2px;border:1px solid #aaa;border-radius:3px;font-size:10px;font-weight:700;">#${p.jersey} ${p.name}</span>`
    ).join('');
  }

  const html = `<!DOCTYPE html>
<html>
<head>
<title>Bronco Braves ‚Äî Line Drive Reads Drill</title>
<style>
  @page { size: letter portrait; margin: 0.4in; }
  @media print { body { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; } }
  body { font-family: Arial, Helvetica, sans-serif; margin: 0; padding: 16px; color: #111; font-size: 11px; line-height: 1.4; }
  h1 { font-size: 18px; font-weight: 900; text-transform: uppercase; letter-spacing: 2px; margin: 0; }
  h1 span { font-weight: 400; font-size: 13px; color: #555; margin-left: 8px; letter-spacing: 0; }
  .date { font-size: 9px; color: #777; }
  .sl { font-size: 10px; font-weight: 900; text-transform: uppercase; letter-spacing: 1.5px; color: #111; border-bottom: 2px solid #111; padding-bottom: 2px; margin: 10px 0 5px; }
  table { width: 100%; border-collapse: collapse; margin-bottom: 6px; }
  table.b { border: 1px solid #bbb; }
  table.b td, table.b th { border: 1px solid #ddd; }
  th { font-size: 9px; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; padding: 4px 8px; text-align: left; background: #f0f0f0; border-bottom: 1px solid #bbb; }
  .g2 { display: flex; gap: 16px; }
  .g2 > div { flex: 1; }
  .sb { border: 1px solid #ccc; border-radius: 4px; padding: 5px 8px; margin-bottom: 4px; page-break-inside: avoid; }
  .st { font-size: 9px; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 2px; }
  .sb p { font-size: 10px; margin: 2px 0; }
  .sb strong { font-weight: 800; }
  .hb { background: #f5f5f5; border-left: 3px solid #333; padding: 3px 8px; margin: 3px 0; font-size: 9px; }
  .absent { font-size: 9px; color: #c00; margin-bottom: 4px; }
  .gl { font-size: 10px; font-weight: 900; margin-bottom: 2px; }
</style>
</head>
<body>
  <div style="display:flex;justify-content:space-between;align-items:baseline;">
    <h1>BRONCO BRAVES <span>Line Drive Reads ‚Äî Base Running Drill</span></h1>
    <div style="text-align:right;">
      <div class="date">${today}</div>
      <div style="font-size:9px;color:#555;">${g1Players.length + g2Players.length} players active</div>
    </div>
  </div>

  ${absentList.length > 0 ? `<div class="absent">ABSENT: ${absentList.map(p => p.name).join(', ')}</div>` : ''}

  <div class="sl">COACHES & FIELD POSITIONS</div>
  <table class="b">
    <tr><th>Position</th><th>Type</th><th>Role</th><th>Name</th></tr>
    ${staffRows}
  </table>

  <div class="g2">
    <div>
      <div class="sl">SETUP</div>
      <table class="b">
        <tr><th style="width:28%;">Element</th><th>Details</th></tr>
        <tr><td style="padding:3px 8px;font-size:10px;font-weight:700;border-bottom:1px solid #ddd;">Equipment</td><td style="padding:3px 8px;font-size:10px;border-bottom:1px solid #ddd;">Fungo bat + glove at home plate (coach hits then catches), bucket of baseballs at home plate, bucket at 1B for collected balls</td></tr>
        <tr><td style="padding:3px 8px;font-size:10px;font-weight:700;border-bottom:1px solid #ddd;">Cones</td><td style="padding:3px 8px;font-size:10px;border-bottom:1px solid #ddd;">Set up behind 1st base and behind 2nd base ‚Äî kids wait in line before taking the base</td></tr>
        <tr><td style="padding:3px 8px;font-size:10px;font-weight:700;border-bottom:1px solid #ddd;">Hits</td><td style="padding:3px 8px;font-size:10px;border-bottom:1px solid #ddd;">Coach hits line drives at or over the head of the 2nd baseman</td></tr>
        <tr><td style="padding:3px 8px;font-size:10px;font-weight:700;border-bottom:1px solid #ddd;">Throws</td><td style="padding:3px 8px;font-size:10px;border-bottom:1px solid #ddd;">RF throws go home. 1B is the cutoff man. 3B has glove just in case.</td></tr>
      </table>
    </div>
    <div>
      <div class="sl">ROTATION FLOW</div>
      <div style="font-size:10px;">
        <p style="margin:2px 0;"><strong>1.</strong> Runner takes lead, then secondary.</p>
        <p style="margin:2px 0;"><strong>2.</strong> Coach hits line drive at/over the 2B.</p>
        <p style="margin:2px 0;"><strong>3.</strong> Runner reads and reacts.</p>
        <p style="margin:2px 0;"><strong>4.</strong> After running at 1B ‚Üí get in line at cones for 2nd base.</p>
        <p style="margin:2px 0;"><strong>5.</strong> After running at 2B ‚Üí run all the way around the field, behind the hitter, back in line at 1st base.</p>
      </div>
    </div>
  </div>

  <div class="sl">PLAYER ASSIGNMENTS</div>
  <div class="g2">
    <div>
      <div class="gl">Group 1 ‚Äî Start at 1st Base (${g1Players.length})</div>
      <div style="margin-bottom:4px;">${playerGrid(g1Players)}</div>
    </div>
    <div>
      <div class="gl">Group 2 ‚Äî Start at 2nd Base (${g2Players.length})</div>
      <div>${playerGrid(g2Players)}</div>
    </div>
  </div>

  <div class="sl">LINE DRIVE READS ‚Äî BOTH BASES</div>
  <div class="sb">
    <div class="st">‚ö° Key Coaching Point: Early Read</div>
    <p><strong>Eyes on the ball off the bat.</strong> The read starts immediately ‚Äî not after the ball passes the infielder. Read trajectory and the 2B's reaction in the first half-second.</p>
    <div class="hb">The early read is what makes advancing two bases possible. A late read means you only get one.</div>
  </div>

  <div class="g2">
    <div>
      <div class="sb">
        <div class="st">üü¢ Ball Gets Through / Drops into RF</div>
        <p><strong>Advance two bases.</strong> Runner on 1st ‚Üí 3rd (or scores). Runner on 2nd ‚Üí scores.</p>
        <p>Early read = aggressive secondary = already moving.</p>
      </div>
    </div>
    <div>
      <div class="sb">
        <div class="st">üî¥ 2nd Baseman Catches It</div>
        <p><strong>Get back to your base.</strong> 2B can make a quick throw to 1st or 2nd to double you off.</p>
        <p>Never be so far off you can't recover on a line drive catch.</p>
      </div>
    </div>
  </div>

  <div class="g2">
    <div>
      <div class="sb">
        <div class="st">üéØ Runner on 1st ‚Äî Specifics</div>
        <p><strong>If through:</strong> Sprint hard ‚Äî goal is 3rd base (or home on a bobble).</p>
        <p><strong>If caught:</strong> Dive/sprint back to 1st. 2B fires to 1B quickly.</p>
      </div>
    </div>
    <div>
      <div class="sb">
        <div class="st">üéØ Runner on 2nd ‚Äî Specifics</div>
        <p><strong>If through:</strong> Score. Round 3rd with full head of steam.</p>
        <p><strong>If caught:</strong> Get back to 2nd. 2B throw to 2nd is short ‚Äî don't get doubled off.</p>
      </div>
    </div>
  </div>

  <div class="sl">COACHING REMINDERS</div>
  <div style="font-size:10px;">
    <p style="margin:2px 0;">‚Ä¢ <strong>Line drives are the most dangerous play for a baserunner</strong> ‚Äî never assume it's through.</p>
    <p style="margin:2px 0;">‚Ä¢ Emphasize the balance: aggressive secondary, but always recoverable.</p>
    <p style="margin:2px 0;">‚Ä¢ 2B coach should vary ‚Äî catch some, let some through, snag some at the shoetops.</p>
    <p style="margin:2px 0;">‚Ä¢ Keep the line moving ‚Äî next runner steps on base as soon as previous runner clears.</p>
  </div>
</body>
</html>`;

  const printWindow = window.open('', '_blank');
  printWindow.document.write(html);
  printWindow.document.close();
  printWindow.focus();
  setTimeout(() => printWindow.print(), 400);
}

render();
</script>
</body>
</html>
